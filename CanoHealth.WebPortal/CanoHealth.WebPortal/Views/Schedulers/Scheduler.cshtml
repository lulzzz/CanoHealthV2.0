@using CanoHealth.WebPortal.ViewModels;
@{
    ViewBag.Title = "Calendar";
    Layout = "~/Views/Shared/_LayoutPage1.cshtml";
}

<header class="main-header main-header-inverse">
    <div class="container">
        <h1 class="page-title">Doctor's Schedule</h1>

        <ol class="breadcrumb pull-right">

            <li><a href="/">Home</a></li>
            <li class="active">Scheduler</li>
        </ol>
    </div>
</header>

@Html.Partial("_CommonHeader")

<br />

<div class="container-fluid">
    @(Html.Kendo().Scheduler<ScheduleViewModel>()
            .Name("DoctorSchedule")
            .Date(DateTime.Today)
            .AllDaySlot(false)
            .Editable(ed => ed
                .Confirmation("Are you sure you want to delete this schedule?")
                .Resize(true)
                .Window(wnd => {
                    wnd.Resizable(r => r.MaxWidth(600).MinWidth(600));
                    wnd.Title("Schedule");
                    wnd.Actions(ac => ac.Minimize().Maximize().Close());
                })
            )
            .Views(views =>
            {
                views.DayView();
                views.WeekView();
                views.MonthView(monthView => monthView.Selected(true));
                views.AgendaView();
                views.TimelineView();
            })
            .StartTime(new DateTime(2018, 9, 3, 7, 00, 00))
            .EndTime(new DateTime(2018, 9, 3, 18, 00, 00))
            //.EventTemplate("template-scheduledetails")
            .Footer(footer =>
            {
                footer.Command("workDay");
            })
            .Timezone("Etc/UTC")
            .DataSource(ds => ds
                .ServerOperation(true)
                .Model(model =>
                {
                    model.Id(m => m.ScheduleId);
                    model.Field(m => m.IsAllDay).DefaultValue(true);
                })
                .Read("ReadSchedules", "Schedulers")
                .Create("CreateSchedule", "Schedulers")
            )
            .Resources(resource => {
                resource.Add(r => r.LocationId)
                .DataValueField("PlaceOfServiceId")
                .DataTextField("Name")
                .Multiple(false)
                .Title("Location")
                .Name("Location")
                .DataSource(dsl => dsl
                    .ServerFiltering(false)
                    .Read(read => read.Action("GetLocations", "PlaceOfService"))
                );
                resource.Add(r => r.Doctors)
                .Name("Doctors")
                .Title("Doctors")
                .DataValueField("DoctorId")
                .DataTextField("FullName")
                .Multiple(true)
                .DataSource(source =>
                {
                    source.Custom()
                        .ServerFiltering(true)
                        .Type("aspnetmvc-ajax")
                        .Transport(transport =>
                        {
                            transport.Read("GetActiveDoctors", "Doctors");
                        })
                        .Schema(schema =>
                        {
                            schema.Data("Data")
                                .Total("Total");
                        });
                });
            })

    //.WorkDayEnd()
    )
</div>

<script type="text/x-kendo-template" id="template-scheduledetails">
    <div>Title: #=Title#</div>
    @*<div>
        Atendees:
        # for (var i = 0; i < resources.length; i++) { #
        #: resources[i].text #
        # } #
    </div>*@
</script>

@section Scripts{
    <script src="~/Scripts/kendo/2018.1.221/kendo.timezones.min.js"></script>
}
